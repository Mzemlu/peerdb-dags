–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–∞ –≥–∏—Ç–µ pg_tree_metrics_update
–∑–∞–ª–∏—Ç—å —Ç—É–¥–∞ SQL:
bi_load_factor_with_closed_clubs.sql	
bi_metric_alt.sql	
bi_metric_load_factor.sql
bi_metric_ltv_cac.sql
bi_metric_tree_by_month.sql	
bi_metric_tree_by_year.sql

–ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è bi_load_factor_with_closed_clubs.sql:
ddxfitness_prod_v2.d_day
ddxfitness_prod_v2.inflow_and_outflow
ddxfitness_prod_v2.active_users_by_clubs
ddxfitness_prod_v2.pg_clubs

–ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è bi_metric_alt.sql:
ddxfitness_prod_v2.inflow_and_outflow_new

–ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è bi_metric_load_factor.sql:
ddxfitness_prod_v2.d_day
ddxfitness_prod_v2.inflow_and_outflow_new
ddxfitness_prod_v2.active_users_by_clubs
ddxfitness_prod_v2.pg_clubs

–ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è bi_metric_ltv_cac.sql:
ddxfitness_prod_v2.d_day
ddxfitness_prod_v2.inflow_and_outflow_new
ddxfitness_prod_v2.active_users_by_clubs
ddxfitness_prod_v2.all_expenses
ddxfitness_prod_v2.pg_clubs

–ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è bi_metric_tree_by_month.sql:
ddxfitness_prod_v2.d_day
ddxfitness_prod_v2.pg_clubs
ddxfitness_prod_v2.bi_metric_alt
ddxfitness_prod_v2.bi_metric_load_factor
ddxfitness_prod_v2.revenue
ddxfitness_prod_v2.bi_metric_ltv_cac

–ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è bi_metric_tree_by_year.sql:
ddxfitness_prod_v2.d_day
ddxfitness_prod_v2.pg_clubs
ddxfitness_prod_v2.bi_metric_tree_by_month


–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–∏—Ö
üì§bi_metric_alt.sql
–ó–∞–ø–∏—Å—å –≤:
ddxfitness_prod_v2.bi_metric_alt

üì§bi_metric_load_factor.sql
–ó–∞–ø–∏—Å—å –≤:
ddxfitness_prod_v2.bi_metric_load_factor

üì§bi_metric_ltv_cac.sql
–ó–∞–ø–∏—Å—å –≤:
ddxfitness_prod_v2.bi_metric_ltv_cac

üì§ bi_load_factor_with_closed_clubs.sql
–ó–∞–ø–∏—Å—å –≤:
ddxfitness_prod_v2.bi_load_factor_with_closed_clubs

üì§bi_metric_tree_by_month.sql
–ó–∞–ø–∏—Å—å –≤:
ddxfitness_prod_v2.bi_metric_tree_by_month

üì§bi_metric_tree_by_year.sql
–ó–∞–ø–∏—Å—å –≤:
ddxfitness_prod_v2.bi_metric_tree_by_year


–ö–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –Ω–∞ PeerDB:

-- ddxfitness_prod_v2.bi_metric_alt –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

CREATE TABLE ddxfitness_prod_v2.bi_metric_alt
(

    `date` Date32,

    `club_id` Int32,

    `club_name` String,

    `alt` Int32
)
ENGINE = MergeTree
ORDER BY (date,
 club_name)
SETTINGS index_granularity = 8192;



-- ddxfitness_prod_v2.bi_metric_load_factor –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

CREATE TABLE ddxfitness_prod_v2.bi_metric_load_factor
(

    `date` Date32,

    `club_id` Int32,

    `club_name` String,

    `outflow` Int64,

    `inflow` Int64,

    `outflow_with_migration` Int64,

    `inflow_with_migration` Int64,

    `active_subscribes` Nullable(Decimal(9,
 2)),

    `area_in_square_meters` Nullable(Decimal(9,
 2)),

    `load_factor` Nullable(Decimal(9,
 2))
)
ENGINE = MergeTree
ORDER BY (date,
 club_name)
SETTINGS index_granularity = 8192;


-- ddxfitness_prod_v2.bi_metric_ltv_cac –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

CREATE TABLE ddxfitness_prod_v2.bi_metric_ltv_cac
(

    `date` Date32,

    `club_id` Int32,

    `club_name` String,

    `open_date` Date32,

    `acquisition_cost` Int64,

    `club_ebitda` Int64,

    `is_inflow` Int64,

    `active_subscribers` Int64,

    `cac` Nullable(Float64),

    `ltv` Nullable(Float64),

    `ratio_ltv_cac` Nullable(Float64)
)
ENGINE = MergeTree
ORDER BY (date,
 club_name)
SETTINGS index_granularity = 8192;



-- ddxfitness_prod_v2.bi_load_factor_with_closed_clubs –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

CREATE TABLE ddxfitness_prod_v2.bi_load_factor_with_closed_clubs
(

    `date` Date32,

    `club_id` Int32,

    `club_name` String,

    `outflow` Int64,

    `inflow` Int64,

    `outflow_with_migration` Int64,

    `inflow_with_migration` Int64,

    `active_subscribes` Nullable(Decimal(9,
 2)),

    `area_in_square_meters` Nullable(Decimal(9,
 2)),

    `load_factor` Nullable(Decimal(9,
 2))
)
ENGINE = MergeTree
ORDER BY (date,
 club_name)
SETTINGS index_granularity = 8192;


-- ddxfitness_prod_v2.bi_metric_tree_by_month –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

CREATE TABLE ddxfitness_prod_v2.bi_metric_tree_by_month
(

    `year` String,

    `date` Date,

    `club_id` Int64,

    `club_name` String,

    `alt` Nullable(Int32),

    `outflow` Int64,

    `inflow` Int64,

    `area_in_square_meters` Decimal(9,
 2),

    `load_factor` Nullable(Decimal(9,
 2)),

    `revenue` Nullable(Int64),

    `acquisition_cost` Nullable(Int64),

    `club_ebitda` Nullable(Int64),

    `active_subscribers` Nullable(Int64),

    `cac` Nullable(Float64),

    `ltv` Nullable(Float64),

    `arpu` Nullable(Float64),

    `nsm_metric` Nullable(Float64)
)
ENGINE = MergeTree
ORDER BY (date,
 club_name,
 year)
SETTINGS index_granularity = 8192;


-- ddxfitness_prod_v2.bi_metric_tree_by_year –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

CREATE TABLE ddxfitness_prod_v2.bi_metric_tree_by_year
(

    `date` Date,

    `year` String,

    `club_id` Int64,

    `club_name` String,

    `club_type` Nullable(String),

    `tir` String,

    `age` String,

    `alt` Nullable(Int32),

    `outflow` Int64,

    `inflow` Int64,

    `area_in_square_meters` Decimal(9,
 2),

    `load_factor` Nullable(Decimal(9,
 2)),

    `revenue` Nullable(Int64),

    `acquisition_cost` Nullable(Int64),

    `club_ebitda` Nullable(Int64),

    `active_subscribers` Nullable(Int64),

    `cac` Nullable(Float64),

    `ltv` Nullable(Float64),

    `arpu` Nullable(Float64),

    `nsm_metric` Nullable(Float64),

    `year_2` String,

    `club_id_2` Int64,

    `club_name_2` String,

    `club_type_2` Nullable(String),

    `tir_2` String,

    `age_2` String,

    `alt_2` Nullable(Int32),

    `outflow_2` Int64,

    `inflow_2` Int64,

    `area_in_square_meters_2` Decimal(9,
 2),

    `load_factor_2` Nullable(Decimal(9,
 2)),

    `revenue_2` Nullable(Int64),

    `acquisition_cost_2` Nullable(Int64),

    `club_ebitda_2` Nullable(Int64),

    `active_subscribers_2` Nullable(Int64),

    `cac_2` Nullable(Float64),

    `ltv_2` Nullable(Float64),

    `arpu_2` Nullable(Float64),

    `nsm_metric_2` Nullable(Float64)
)
ENGINE = MergeTree
ORDER BY (year,
 year_2,
 club_name,
 club_name_2)
SETTINGS index_granularity = 8192;
